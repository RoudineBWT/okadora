# Migrate existing user to Okadora (install Niri/Noctalia configs)
migrate-to-okadora:
    #!/usr/bin/bash
    echo "ðŸš€ Migrating your user to Okadora configuration..."
    
    # Copier les configs Niri
    if [ -d "/etc/skel/.config/niri" ]; then
        if [ ! -d "$HOME/.config/niri" ]; then
            echo "ðŸ“¦ Installing Niri configuration..."
            mkdir -p "$HOME/.config"
            cp -r /etc/skel/.config/niri "$HOME/.config/"
            echo "âœ… Niri config installed"
        else
            echo "âš ï¸  Niri config already exists"
            read -p "Do you want to overwrite it? (y/N): " -n 1 -r
            echo
            if [[ $REPLY =~ ^[Yy]$ ]]; then
                cp -rf /etc/skel/.config/niri "$HOME/.config/"
                echo "âœ… Niri config overwritten"
            fi
        fi
    fi
    
    # Copier les configs Noctalia
    if [ -d "/etc/skel/.config/noctalia" ]; then
        if [ ! -d "$HOME/.config/noctalia" ]; then
            echo "ðŸ“¦ Installing Noctalia configuration..."
            mkdir -p "$HOME/.config"
            cp -r /etc/skel/.config/noctalia "$HOME/.config/"
            echo "âœ… Noctalia config installed"
        else
            echo "âš ï¸  Noctalia config already exists"
            read -p "Do you want to overwrite it? (y/N): " -n 1 -r
            echo
            if [[ $REPLY =~ ^[Yy]$ ]]; then
                cp -rf /etc/skel/.config/noctalia "$HOME/.config/"
                echo "âœ… Noctalia config overwritten"
            fi
        fi
    fi
    
    # Copier autres configs importantes
    if [ -d "/etc/skel/.config/fish" ]; then
        if [ ! -d "$HOME/.config/fish" ]; then
            echo "ðŸ“¦ Installing Fish configuration..."
            mkdir -p "$HOME/.config"
            cp -r /etc/skel/.config/fish "$HOME/.config/"
            echo "âœ… Fish config installed"
        fi
    fi
    
    # Marquer comme migrÃ©
    mkdir -p "$HOME/.config/okadora"
    touch "$HOME/.config/okadora/migrated"
    
    echo ""
    echo "âœ¨ Migration complete! Please log out and back in for changes to take effect."
    echo "ðŸ’¡ Tip: Set Niri as your default session at the login screen."

# Force reinstall all Okadora configs (overwrites existing)
reinstall-okadora-configs:
    #!/usr/bin/bash
    echo "âš ï¸  WARNING: This will OVERWRITE your existing Niri/Noctalia configs!"
    read -p "Are you sure? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "ðŸ“¦ Reinstalling all Okadora configs..."
        
        # Backup d'abord
        BACKUP_DIR="$HOME/.config/okadora-backup-$(date +%Y%m%d-%H%M%S)"
        mkdir -p "$BACKUP_DIR"
        
        if [ -d "$HOME/.config/niri" ]; then
            cp -r "$HOME/.config/niri" "$BACKUP_DIR/"
            echo "ðŸ’¾ Backup: $BACKUP_DIR/niri"
        fi
        
        if [ -d "$HOME/.config/noctalia" ]; then
            cp -r "$HOME/.config/noctalia" "$BACKUP_DIR/"
            echo "ðŸ’¾ Backup: $BACKUP_DIR/noctalia"
        fi
        
        # RÃ©installer
        if [ -d "/etc/skel/.config/niri" ]; then
            mkdir -p "$HOME/.config"
            cp -rf /etc/skel/.config/niri "$HOME/.config/"
            echo "âœ… Niri config reinstalled"
        fi
        
        if [ -d "/etc/skel/.config/noctalia" ]; then
            mkdir -p "$HOME/.config"
            cp -rf /etc/skel/.config/noctalia "$HOME/.config/"
            echo "âœ… Noctalia config reinstalled"
        fi
        
        if [ -d "/etc/skel/.config/fish" ]; then
            mkdir -p "$HOME/.config"
            cp -rf /etc/skel/.config/fish "$HOME/.config/"
            echo "âœ… Fish config reinstalled"
        fi
        
        echo ""
        echo "âœ¨ All configs reinstalled!"
        echo "ðŸ’¾ Old configs backed up to: $BACKUP_DIR"
    else
        echo "âŒ Cancelled."
    fi

# Show Okadora system information
okadora-info:
    #!/usr/bin/bash
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘          ðŸŒ¸ Okadora Info ðŸŒ¸           â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo ""
    
    # Image info
    if [ -f /usr/share/ublue-os/image-info.json ]; then
        IMAGE_NAME=$(jq -r '."image-name"' /usr/share/ublue-os/image-info.json 2>/dev/null || echo "okadora")
        IMAGE_TAG=$(jq -r '."image-tag"' /usr/share/ublue-os/image-info.json 2>/dev/null || echo "unknown")
        echo "ðŸ“¦ Image: $IMAGE_NAME:$IMAGE_TAG"
    fi
    
    echo "ðŸ“¦ Based on: Bazzite Gnome"
    echo "ðŸªŸ Window Manager: Niri (Wayland)"
    echo "ðŸŽ¨ Shell: Noctalia"
    echo "ðŸš Terminal Shell: Fish"
    echo ""
    
    # VÃ©rifier l'Ã©tat de migration
    if [ -f "$HOME/.config/okadora/migrated" ]; then
        echo "âœ… Okadora configs: Installed"
    else
        echo "âš ï¸  Okadora configs: Not installed"
    fi
    
    # VÃ©rifier Niri
    if command -v niri &> /dev/null; then
        NIRI_VERSION=$(niri --version 2>/dev/null | head -n1 || echo "installed")
        echo "ðŸªŸ Niri: $NIRI_VERSION"
    fi
    
    echo ""
    echo "ðŸ“‹ Available commands:"
    echo "  ujust migrate-to-okadora        - Install Okadora configs"
    echo "  ujust reinstall-okadora-configs - Reinstall all configs (with backup)"
    echo "  ujust okadora-info              - Show this info"
    echo ""
    echo "ðŸ“š Documentation: https://github.com/RoudineBWT/okadora"

# Reset Okadora migration status (allows re-running migration)
reset-okadora-migration:
    #!/usr/bin/bash
    echo "ðŸ”„ Resetting Okadora migration status..."
    rm -f "$HOME/.config/okadora/migrated"
    rm -f "$HOME/.config/okadora/migration-declined"
    echo "âœ… Migration status reset"
    echo "ðŸ’¡ Run 'ujust migrate-to-okadora' or restart your terminal to migrate again"

    # Backup current Okadora configs
backup-okadora-configs:
    #!/usr/bin/bash
    BACKUP_DIR="$HOME/.config/okadora-backup-$(date +%Y%m%d-%H%M%S)"
    mkdir -p "$BACKUP_DIR"
    
    if [ -d "$HOME/.config/niri" ]; then
        cp -r "$HOME/.config/niri" "$BACKUP_DIR/"
        echo "ðŸ’¾ Niri backed up to: $BACKUP_DIR"
    fi
    
    if [ -d "$HOME/.config/noctalia" ]; then
        cp -r "$HOME/.config/noctalia" "$BACKUP_DIR/"
        echo "ðŸ’¾ Noctalia backed up to: $BACKUP_DIR"
    fi
    
    echo "âœ… Backup complete: $BACKUP_DIR"

# Show differences between current config and default
diff-okadora-configs:
    #!/usr/bin/bash
    echo "ðŸ“Š Comparing your configs with Okadora defaults..."
    echo ""
    
    if [ -d "/etc/skel/.config/niri" ] && [ -d "$HOME/.config/niri" ]; then
        echo "ðŸªŸ Niri differences:"
        diff -r /etc/skel/.config/niri "$HOME/.config/niri" || true
        echo ""
    fi
    
    if [ -d "/etc/skel/.config/noctalia" ] && [ -d "$HOME/.config/noctalia" ]; then
        echo "ðŸŽ¨ Noctalia differences:"
        diff -r /etc/skel/.config/noctalia "$HOME/.config/noctalia" || true
    fi